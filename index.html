<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>MajMarket</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{
      --bg:#0C0C10; --card:#111117; --line:#252530; --text:#FFFFFF; --muted:#CFCFDE;
      --accent:#E93E8F; --ok:#2DD688; --warn:#E5C15A; --err:#FF4A4A;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--text);
      font:16px/1.45 -apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Arial;
    }
    .app{min-height:100vh;display:flex;flex-direction:column}
    .container{max-width:980px;margin:0 auto;padding:16px 16px 104px}

    /* ===== look & feel ===== */
    .hero{
      background:
        radial-gradient(140% 140% at 20% 0%, rgba(233,62,143,.25) 0%, rgba(233,62,143,.07) 38%, rgba(17,17,23,1) 62%),
        linear-gradient(180deg,#14141b 0%, #0f0f14 100%);
      border:1px solid var(--line); border-radius:22px; padding:18px; margin:8px 0 12px;
    }
    .title{display:flex;align-items:center;gap:10px;margin-bottom:6px}
    .badge{
      width:34px;height:34px;border-radius:11px;background:#1b1b22;
      display:flex;align-items:center;justify-content:center;font-weight:800;color:var(--accent)
    }
    .balance{display:flex;align-items:baseline;gap:10px;margin:10px 0 12px}
    .amount{font-size:30px;font-weight:800;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:13px}

    .actions{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:6px}
    .tile{
      display:flex;flex-direction:column;align-items:center;gap:8px;
      background:#111117;border:1px solid var(--line);border-radius:16px;padding:12px;cursor:pointer;user-select:none
    }
    .tile i,.icoBox,.tabbar .icoBox{
      display:flex;align-items:center;justify-content:center;
      background:#1b1b22;border-radius:12px
    }
    .tile i{width:40px;height:40px}            /* –ø–ª–∏—Ç–∫–∏ (–ì–ª–∞–≤–Ω–∞—è/–ù–∞—Å—Ç—Ä–æ–π–∫–∏) */
    .icoBox{width:42px;height:42px}
    .tabbar .icoBox{width:30px;height:30px;border-radius:10px}   /* –¢–ê–ë-–ò–ö–û–ù–ö–ê ‚Äî –û–î–ò–ù –†–ê–ó–ú–ï–† */
    .tile i b,.icoBox b,.tabbar .icoBox b{color:var(--accent);font-size:20px;font-weight:800;line-height:1}
    .tile span{font-size:12px}

    .row{display:flex;flex-wrap:wrap;gap:10px}
    .chip{border:1px solid var(--line);border-radius:12px;padding:6px 10px;color:var(--muted);font-size:13px}
    .btn{background:var(--accent);border:0;color:#fff;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid var(--line);color:#fff}
    .btn.secondary{background:#1a1a21;border:1px solid var(--line);color:#fff}
    .card{background:#111117;border:1px solid var(--line);border-radius:18px;padding:14px}
    .card h3,.card h4{margin:0 0 8px}
    .meta{color:var(--muted);font-size:13px;margin:2px 0 10px}
    .price{color:var(--accent);font-weight:800}

    input,select,textarea{
      width:100%;background:#0f0f14;color:#fff;border:1px solid var(--line);
      border-radius:12px;padding:12px
    }
    label{display:block;font-size:13px;color:var(--muted);margin:10px 0 6px}

    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-top:4px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
    .product{background:#0f0f14;border:1px solid var(--line);border-radius:16px;padding:14px}
    .product h4{margin:0 0 6px}

    /* ===== tabbar (minimal) ===== */
    .tabbar{
      position:fixed;left:0;right:0;bottom:0;background:#0B0B0F;
      border-top:1px solid var(--line);display:flex;padding:8px 6px
    }
    .tabbar .item{
      flex:1;background:transparent;border:0;color:#CFCFDE;
      display:flex;flex-direction:column;align-items:center;gap:6px;
      padding:8px 4px 12px;font-weight:800
    }
    .tabbar .item .lbl{font-size:12px}
    .tabbar .item.active{color:#fff;border-top:2px solid var(--accent)}

    /* ===== range (pink) ===== */
    input[type=range]{-webkit-appearance:none;width:100%;background:transparent}
    input[type=range]::-webkit-slider-runnable-track{
      height:6px;background:#2B2B33;border-radius:4px
    }
    input[type=range]::-webkit-slider-thumb{
      -webkit-appearance:none;height:22px;width:22px;background:var(--accent);
      border-radius:50%;margin-top:-8px;cursor:pointer;border:0
    }
    input[type=range]:focus::-webkit-slider-runnable-track{background:#3A3A44}
    /* Firefox */
    input[type=range]::-moz-range-track{height:6px;background:#2B2B33;border-radius:4px}
    input[type=range]::-moz-range-thumb{height:20px;width:20px;background:var(--accent);border-radius:50%;border:0}

    /* toast */
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:104px;background:#15151d;border:1px solid var(--line);padding:10px 14px;border-radius:10px;display:none;z-index:20}
    a.link{color:var(--accent);text-decoration:none}
  </style>
</head>
<body>
<div class="app">
  <div class="container"><div id="screen"></div></div>

  <!-- Minimal tabbar with equal-size icons -->
  <div class="tabbar">
    <button class="tab item" data-tab="home" onclick="App.route('home')">
      <span class="icoBox"><b>‚åÇ</b></span><span class="lbl">–ì–ª–∞–≤–Ω–∞—è</span>
    </button>
    <button class="tab item" data-tab="trade" onclick="App.route('trade')">
      <span class="icoBox"><b>‚Üó</b></span><span class="lbl">–¢–æ—Ä–≥–æ–≤–ª—è</span>
    </button>
    <button class="tab item" data-tab="settings" onclick="App.route('settings')">
      <span class="icoBox"><b>‚öôÔ∏é</b></span><span class="lbl">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
    </button>
    <button class="tab item" id="tab-mod" data-tab="moderation" onclick="App.route('moderation')">
      <span class="icoBox"><b>üõ°</b></span><span class="lbl">–ú–æ–¥–µ—Ä–∞—Ü–∏—è</span>
    </button>
  </div>
</div>

<div id="toast" class="toast"></div>

<script>
const Store = {
  key:'majmarket-state',
  load(){ try{const raw=localStorage.getItem(this.key); if(!raw) return this.seed(); return JSON.parse(raw);}catch(e){return this.seed()} },
  seed(){
    return {
      user:{}, role:'user',
      wallet:{ balance:100000, hold:0, history:[] },
      listings:[
        { id:uid(), seller:null, title:'–§—É—Ç–±–æ–ª–∫–∞ Majestic',    price_mjt:1500, category:'–û–¥–µ–∂–¥–∞',    server:'RU1', status:'active', created_at:Date.now() },
        { id:uid(), seller:null, title:'–ö–∞—Å—Ç–æ–º —Å–∫–∏–Ω (—É—Å–ª—É–≥–∞)', price_mjt:3200, category:'–£—Å–ª—É–≥–∏',    server:'RU2', status:'active', created_at:Date.now()-100000 },
        { id:uid(), seller:null, title:'–ù–æ–º–µ—Ä –ê777–ê–ê',         price_mjt:8000, category:'–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', server:'RU1', status:'active', created_at:Date.now()-200000 }
      ],
      orders:[]
    }
  },
  save(d){ localStorage.setItem(this.key, JSON.stringify(d)); }
};
function uid(){ return Math.random().toString(36).slice(2) }

const App = {
  data: Store.load(),
  botUsername: 'MajMarketBot',

  route(name,param){ location.hash = name + (param?':'+param:''); this.render(); },
  toast(msg){ const t=document.getElementById('toast'); t.textContent=msg; t.style.display='block'; setTimeout(()=>t.style.display='none',1500); },

  setActiveTab(name){
    document.querySelectorAll('.tabbar .item').forEach(el=>{
      el.classList.toggle('active', el.dataset.tab===name);
    });
    const mod = document.getElementById('tab-mod');
    if(mod) mod.style.display = (this.data.role==='moderator'?'flex':'none');
  },

  openModerators(){
    try{
      const url = "https://t.me/majmarket_bot";
      if(window.Telegram?.WebApp?.openTelegramLink) window.Telegram.WebApp.openTelegramLink(url);
      else window.open(url, "_blank", "noopener");
    }catch(e){ window.open("https://t.me/majmarket_bot","_blank","noopener"); }
  },

  initUserFromTelegram(){
    try{
      const tg = window.Telegram?.WebApp;
      tg?.ready(); tg?.expand(); tg?.MainButton?.hide();
      const u = tg?.initDataUnsafe?.user;
      if(u){
        this.data.user = { id:u.id, username:u.username||u.first_name||('user'+u.id) };
        this.data.listings.forEach(l=>{ if(!l.seller) l.seller=this.data.user.id; });
        Store.save(this.data);
      }
    }catch(e){}
  },

  /* ===== Screens ===== */
  screenHome(){
    const w = this.data.wallet;
    const u = this.data.user.username || '–ì–æ—Å—Ç—å';
    const recent = this.data.orders.slice(-5).reverse().map(o=>{
      const l = this.data.listings.find(x=>x.id===o.listing_id);
      return `<div class="chip">#${o.id.slice(0,5)} ¬∑ ${l?.title||'–õ–æ—Ç'} ¬∑ <b>${o.status}</b></div>`;
    }).join('') || '<span class="chip">–ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</span>';

    return `
      <div class="hero">
        <div class="title">
          <div class="badge">M</div>
          <div>
            <div style="font-weight:800">MajMarket</div>
            <div class="meta">–ü—Ä–∏–≤–µ—Ç, ${u} üëã</div>
          </div>
        </div>

        <div class="balance">
          <div class="amount">${w.balance} MJT</div>
          <div class="sub">–≤ —É–¥–µ—Ä–∂–∞–Ω–∏–∏: ${w.hold}</div>
        </div>

        <div class="actions">
          <div class="tile" onclick="App.route('topup')"><i><b>Ôºã</b></i><span>–ü–æ–ø–æ–ª–Ω–∏—Ç—å</span></div>
          <div class="tile" onclick="App.route('trade')"><i><b>‚Üì</b></i><span>–ü–æ–∫—É–ø–∫–∞</span></div>
          <div class="tile" onclick="App.route('sell')"><i><b>‚Üë</b></i><span>–ü—Ä–æ–¥–∞–∂–∞</span></div>
        </div>
      </div>

      <div class="card">
        <h4>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏ / –ø—Ä–æ–¥–∞–∂–∏</h4>
        <div class="row" style="margin-top:6px">${recent}</div>
      </div>
    `;
  },

  screenTrade(){
    const list = this.data.listings
      .filter(x=>x.status==='active')
      .sort((a,b)=>b.created_at-a.created_at);

    return `
      <div class="card">
        <h3>–¢–æ—Ä–≥–æ–≤–ª—è</h3>
        <div class="toolbar">
          <input id="q" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é‚Ä¶"/>
          <select id="cat">
            <option value="">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</option>
            <option>–û–¥–µ–∂–¥–∞</option><option>–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</option>
            <option>–£—Ç–∏–ª–∏—Ç—ã</option><option>–£—Å–ª—É–≥–∏</option>
            <option>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option><option>–ü—Ä–æ—á–µ–µ</option>
          </select>
          <select id="srv"><option value="">–°–µ—Ä–≤–µ—Ä</option><option>RU1</option><option>RU2</option><option>RU3</option></select>
          <button class="btn secondary" onclick="App.render()">–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å</button>
          <button class="btn" onclick="App.route('sell')">+ –í—ã—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–¥–∞–∂—É</button>
        </div>
      </div>

      <div class="grid" style="margin-top:12px">
        ${list.map(l=>`
          <div class="product">
            <h4>${l.title}</h4>
            <div class="meta">${l.category} ‚Ä¢ ${l.server}</div>
            <div class="price">${l.price_mjt} MJT</div>
            <div class="toolbar">
              <button class="btn" onclick="App.route('order','${l.id}')">–ö—É–ø–∏—Ç—å</button>
              <button class="btn ghost" onclick="App.toast('–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ: —Å–∫–æ—Ä–æ')">–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</button>
            </div>
          </div>
        `).join('')}
      </div>
    `;
  },

  screenSell(){
    return `
      <div class="card">
        <h3>–ù–æ–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</h3>
        <label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label><input id="t" placeholder="–ù–∞–ø—Ä. –•—É–¥–∏ Majestic"/>
        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
          <select id="c"><option>–û–¥–µ–∂–¥–∞</option><option>–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</option><option>–£—Ç–∏–ª–∏—Ç—ã</option><option>–£—Å–ª—É–≥–∏</option><option>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option><option>–ü—Ä–æ—á–µ–µ</option></select>
        <label>–°–µ—Ä–≤–µ—Ä *</label>
          <select id="s"><option>RU1</option><option>RU2</option><option>RU3</option></select>
        <label>–¶–µ–Ω–∞ (MJT) *</label><input id="p" type="number" min="1" placeholder="1000"/>
        <div class="toolbar"><button class="btn" onclick="App.createListing()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button></div>
      </div>
    `;
  },

  screenOrder(listingId){
    const l = this.data.listings.find(x=>x.id===listingId);
    if(!l) return `<div class="card">–õ–æ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω</div>`;
    const fee = Math.round(l.price_mjt*0.03);

    return `
      <div class="card">
        <h3>${l.title}</h3>
        <div class="meta">${l.category} ‚Ä¢ ${l.server}</div>
        <div class="price" style="margin:8px 0">${l.price_mjt} MJT</div>
        <div class="chip">–ö–æ–º–∏—Å—Å–∏—è: ${fee} MJT</div>
        <div class="toolbar" style="margin-top:10px">
          <button class="btn" onclick="App.hold('${l.id}')">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å ${l.price_mjt} MJT</button>
          <button class="btn secondary" onclick="App.route('trade')">–ù–∞–∑–∞–¥</button>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <b>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</b><br/>‚Ä¢ –≠—Å–∫—Ä–æ—É —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å—É–º–º—É ‚Üí –ü–µ—Ä–µ–¥–∞—á–∞ ‚Üí –î–≤–æ–π–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí –í—ã–ø–ª–∞—Ç–∞.
      </div>
    `;
  },

  screenSettings(){
    const w = this.data.wallet;
    return `
      <div class="hero">
        <div class="title">
          <div class="badge">‚öôÔ∏é</div><div style="font-weight:800">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
        </div>
        <div class="row" style="margin:6px 0 10px">
          <div class="chip">–ë–∞–ª–∞–Ω—Å: <b>${w.balance}</b> MJT</div>
          <div class="chip">–í —É–¥–µ—Ä–∂–∞–Ω–∏–∏: <b>${w.hold}</b> MJT</div>
        </div>
        <div class="actions" style="grid-template-columns:repeat(3,1fr)">
          <div class="tile" onclick="App.route('topup')"><i><b>Ôºã</b></i><span>–ü–æ–ø–æ–ª–Ω–∏—Ç—å</span></div>
          <div class="tile" onclick="App.openModerators()"><i><b>‚Ä¶</b></i><span>–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã</span></div>
          <div class="tile" onclick="App.toast('KYC —Å–∫–æ—Ä–æ')"><i><b>ID</b></i><span>–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è</span></div>
        </div>
      </div>

      <div class="card">
        <h4>–ù–µ–¥–∞–≤–Ω–∏–µ –∑–∞–∫–∞–∑—ã</h4>
        <div class="meta">${this.data.orders.slice(-5).reverse().map(o=>`#${o.id.slice(0,5)} ¬∑ ${o.status}`).join(' ¬∑ ') || '–ø–æ–∫–∞ –ø—É—Å—Ç–æ'}</div>
      </div>
    `;
  },

  /* –ù–æ–≤—ã–π —ç–∫—Ä–∞–Ω ‚Äî –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ */
  screenTopup(){
    const start = 1000;
    return `
      <div class="card">
        <h3>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ MJT</h3>
        <div class="meta">–í—ã–±–µ—Ä–∏ —Å—É–º–º—É –ø–æ–ª–∑—É–Ω–∫–æ–º –∏–ª–∏ –≤–≤–µ–¥–∏ –≤—Ä—É—á–Ω—É—é.</div>
        <label>–°—É–º–º–∞ (MJT)</label>
        <input id="topupAmount" type="number" min="100" max="1000000" step="100" value="${start}" oninput="document.getElementById('topupRange').value=this.value"/>
        <label>–ü–æ–ª–∑—É–Ω–æ–∫</label>
        <input id="topupRange" type="range" min="100" max="100000" step="100" value="${start}" oninput="document.getElementById('topupAmount').value=this.value"/>
        <div class="toolbar" style="margin-top:8px">
          <button class="btn" onclick="App.doTopup()">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
          <button class="btn secondary" onclick="App.route('settings')">–û—Ç–º–µ–Ω–∞</button>
        </div>
      </div>
    `;
  },

  /* ===== actions ===== */
  createListing(){
    const t = document.getElementById('t').value.trim();
    const c = document.getElementById('c').value;
    const s = document.getElementById('s').value;
    const p = parseInt(document.getElementById('p').value,10)||0;
    if(!t || !p){ this.toast('–ó–∞–ø–æ–ª–Ω–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω—É'); return; }
    const l = { id:uid(), seller:this.data.user.id||'me', title:t, price_mjt:p, category:c, server:s, status:'active', created_at:Date.now() };
    this.data.listings.unshift(l);
    Store.save(this.data);
    this.toast('–û–±—ä—è–≤–ª–µ–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ');
    this.route('trade');
  },

  async hold(listingId){
    const l = this.data.listings.find(x=>x.id===listingId);
    const w = this.data.wallet;
    if(!l) return;
    if(w.balance < l.price_mjt){ this.toast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ MJT'); return; }

    const order = { id:uid(), listing_id:l.id, buyer_id:this.data.user.id||'me', seller_id:l.seller||this.data.user.id||'me', price:l.price_mjt, status:'created' };
    this.data.orders.push(order);

    w.balance -= l.price_mjt; w.hold += l.price_mjt; order.status='holded';
    w.history.push({kind:'hold', amount:l.price_mjt, ts:Date.now(), order_id:order.id});
    Store.save(this.data);
    this.toast(`–£–¥–µ—Ä–∂–∞–Ω–æ ${l.price_mjt} MJT`);
    this.notify(`–£–¥–µ—Ä–∂–∞–Ω–æ ${l.price_mjt} MJT –ø–æ –∑–∞–∫–∞–∑—É #${order.id.slice(0,5)}`);

    setTimeout(()=>{ order.status='transfer'; Store.save(this.data); this.toast('–ü—Ä–æ–¥–∞–≤–µ—Ü –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –ø–µ—Ä–µ–¥–∞—á—É'); this.notify(`–ó–∞–∫–∞–∑ #${order.id.slice(0,5)}: –ø—Ä–æ–¥–∞–≤–µ—Ü –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –ø–µ—Ä–µ–¥–∞—á—É`) }, 800);
    setTimeout(()=>{
      order.status='completed';
      const fee = Math.round(l.price_mjt*0.03);
      w.hold -= l.price_mjt;
      w.history.push({kind:'release', amount:l.price_mjt-fee, ts:Date.now(), order_id:order.id});
      w.history.push({kind:'fee', amount:fee, ts:Date.now(), order_id:order.id});
      Store.save(this.data);
      this.toast('–°–¥–µ–ª–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞'); this.notify(`–ó–∞–∫–∞–∑ #${order.id.slice(0,5)} –∑–∞–≤–µ—Ä—à—ë–Ω`);
      this.route('home');
    }, 2000);
  },

  doTopup(){
    const el = document.getElementById('topupAmount');
    const amt = Math.max(100, parseInt(el.value,10) || 0);
    this.data.wallet.balance += amt;
    Store.save(this.data);
    this.toast(`+${amt} MJT`);
    this.notify(`–ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ ${amt} MJT`);
    this.route('settings');
  },

  resolve(orderId,decision){
    const o = this.data.orders.find(x=>x.id===orderId);
    if(!o) return;
    o.status = decision==='release' ? 'completed' : 'refunded';
    Store.save(this.data);
    this.toast(`–†–µ—à–µ–Ω–∏–µ: ${decision}`);
  },

  async notify(text){
    try{
      const chat_id = this.data.user.id;
      if(!chat_id) return;
      await fetch('/api/notify',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({chat_id,text})});
    }catch(e){}
  },

  render(){
    const raw = (location.hash||'#home').replace('#','');
    const [name,param] = raw.split(':');
    const known = ['home','trade','sell','order','settings','moderation','topup'];
    if(!known.includes(name)){ this.route('home'); return; }

    this.setActiveTab(name);
    const el = document.getElementById('screen');
    if(name==='home') el.innerHTML = this.screenHome();
    else if(name==='trade') el.innerHTML = this.screenTrade();
    else if(name==='sell') el.innerHTML = this.screenSell();
    else if(name==='order') el.innerHTML = this.screenOrder(param);
    else if(name==='settings') el.innerHTML = this.screenSettings();
    else if(name==='moderation') el.innerHTML = this.screenModeration();
    else if(name==='topup') el.innerHTML = this.screenTopup();
  }
};

window.addEventListener('hashchange', ()=>App.render());
window.addEventListener('load', ()=>{
  if(!location.hash) location.hash='home';
  try{ const tg=window.Telegram?.WebApp; tg?.ready(); tg?.expand(); tg?.MainButton?.hide(); }catch(e){}
  App.initUserFromTelegram();
  App.render();
});
</script>
</body>
</html>